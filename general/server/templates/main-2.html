{% extends "base_page.html" %}

{% block title %}
Pagina Principal
{% endblock title%}

{% block content %}
    <div class="container-fluid main-menu">
        <div class="row">
            <div class="col">
                <ul class="nav justify-content-center">
                    <!-- Cond Menu -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle no-action" href="javascript:void(0)" id="condDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Informacion del Conductor
                        </a>
                        <form method="POST" action="">
                    {{ form.hidden_tag() }}
                    {{ form.opciones(class="btn btn-secondary dropdown-menu") }}
                    {{ form.submit(class="btn btn-primary") }}
                </form>
                    </li>
                    
                    <!-- Pers Menu -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle no-action" href="javascript:void(0)" id="persDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Informacion del Vehiculo
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="persDropdown">
                            <li><a class="dropdown-item" href="#">Option A</a></li>
                            <li><a class="dropdown-item" href="#">Option B</a></li>
                            <li><a class="dropdown-item" href="#">Option C</a></li>
                            <li><a class="dropdown-item" href="#">Option D</a></li>
                        </ul>
                    </li>
                    
                    <!-- Vehic Menu -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle no-action" href="javascript:void(0)" id="vehicDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Informacion de la Persona Natural
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="vehicDropdown">
                            <li><a class="dropdown-item" href="#">Item 1</a></li>
                            <li><a class="dropdown-item" href="#">Item 2</a></li>
                            <li><a class="dropdown-item" href="#">Item 3</a></li>
                            <li><a class="dropdown-item" href="#">Item 4</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container mt-5">
        <div class="row mb-3">            
            <div class="col-3 border border-primary rounded">
                <!-- Conductor 1 (Informacion) Dropdown -->
                <h2 class="nav-link dropdown-toggle no-action">Datos del Conductor</h2>
                <form method="POST" action="">
                    {{ form.hidden_tag() }}
                    {{ form.opciones(class="btn btn-secondary dropdown-menu") }}
                    {{ form.submit(class="btn btn-primary") }}
                </form>
            </div>
            
            <div class="col-3 border border-primary rounded">
                <!-- Persona Natural Dropdown -->
                <h2 class="h5 mb-3 text-center">Datos de la Persona Natural</h2>
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="conductorDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        Elegir Registro
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="conductorDropdown">
                        <li><a class="dropdown-item" href="#">Multas JNE</a></li>
                        <li><a class="dropdown-item" href="#">RUC Persona Natural SUNAT</a></li>
                        <li><a class="dropdown-item" href="#">Lineas Telefonicas OSIPTEL</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="col-3 border border-primary rounded">
            <h2 class="h5 mb-3 text-center">Datos del Vehiculo</h2>
                <div class="row">
                    <div class="col-6">
                    <!-- Vehiculo Dropdown -->
                    <div class="dropdown me-3">
                        <button class="btn btn-primary dropdown-toggle" type="button" id="vehiculoDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Elegir Placa
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="vehiculoDropdown">
                            <li><a class="dropdown-item" href="#">{{placas[0]}}</a></li>
                            <li><a class="dropdown-item" href="#">{{placas[1]}}</a></li>
                            <li><a class="dropdown-item" href="#">{{placas[2]}}</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-6">
                    <!-- Informacion Dropdown -->
                    <div class="dropdown">
                        <button class="btn btn-primary dropdown-toggle" type="button" id="informacionDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Elegir Registro 
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="informacionDropdown">
                            <li><a class="dropdown-item" href="#">SOAT</a></li>
                            <li><a class="dropdown-item" href="#">Revision Tecnica</a></li>
                            <li><a class="dropdown-item" href="#">Ficha SUNARP</a></li>
                            <li><a class="dropdown-item" href="#">Multas MTC</a></li>
                        </ul>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Seccion de Mostrar Informacion -->

    <!-- Brevete -->
    {% if selection == "brevet" %}
    <div class = "row">
        <div class="col-md">
            <table style="color: white; background:#618685; white-space:nowrap">
                <tr>
                    <td colspan="2" style="color: white; font-weight: bold; background-color: #003b6d; text-align: center">
                        Licencia de Conducir (Brevete)
                    </td>
                </tr>
                {%if brevete%}
                <tr>
                    <td style="text-align: right; column-width: 140px">Número</td>
                    <td style="text-align: center; column-width: 260px">{{brevete.numero}}</td>
                </tr>
                <tr>
                    <td style="text-align: right">Clase</td>
                    <td style="text-align: center">{{brevete.clase}}</td>
                </tr>
                <tr>
                    <td style="text-align: right">Formato</td>
                    <td style="text-align: center">{{brevete.formato}}</td>
                </tr>
                <tr>
                    <td style="text-align: right">Expedición</td>
                    <td style="text-align: center">{{brevete.fecha_desde}}</td>
                </tr>
                <tr>
                    <td style="text-align: right;font-weight: bold;">Vencimiento</td>
                    <td style="text-align: center;font-weight: bold;">{{brevete.fecha_hasta}}</td>
                </tr>
                <tr>
                    <td style="text-align: right">Restricciones</td>
                    <td style="text-align: center">{{brevete.restricciones}}</td>
                </tr>
                <tr>
                    <td style="text-align: right">Local de Emisión</td>
                    <td style="text-align: center">{{brevete.local}}</td>
                </tr>
                <tr>
                    <td style="text-align: right">Puntos en Licencia</td>
                    <td style="text-align: center">{{brevete.puntos}}</td>
                </tr>
                <tr>
                    <td style="text-align: right">N° Récord del Conductor</td>
                    <td style="text-align: center">{{brevete.record}}</td>
                </tr>
                {%else%}
                <tr>
                    <td style="text-align: center; column-width: 140px">Sin registro de Licencia de Conducir</td>
                </tr>
                {%endif%}
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Impuesto SAT Lima -->
    {% if selection == "impsat" %}
        <table style="color: white; background:#618685; max-width:100%; white-space:nowrap">
        <tr>
            <td colspan="4" style="color: white; font-weight: bold; background-color: #003b6d; text-align: center">
                Deudas Tributarias SAT Lima
            </td>
        </tr>
        {%if satimps%}

        <tr style="color: white; background:#618685; white-space:nowrap; border: none;">
            <td style="text-align: right; column-width:140px">Código Tributario</td>
            {%for satimp in satimps%}
            <td style="text-align: center; column-width:260px">{{satimp.codigo}}</td>
            {%endfor%}
        </tr>
        <tr style="color: white; background:#618685; white-space:nowrap; border: none;">
            <td style="text-align: right; vertical-align:top">Deudas</td>
            {%for satimp in satimps%}
            {%if satimp.deudas%}
            <td>
                <table style="color: white; background:#618685; max-width:100%; white-space:nowrap">
                    <tr>
                        <td style="text-align: center; column-width:50px; font-weight:bold"> Año </td>
                        <td style="text-align: center; column-width:35px; font-weight:bold"> Trim. </td>
                        <td style="text-align: center; column-width:100px; font-weight:bold"> Documento </td>
                        <td style="text-align: center; column-width:55px; font-weight:bold"> S/</td>
                    </tr>
                    {% for deuda in satimp.deudas %}
                    <tr>
                        <td style="text-align: center">{{deuda.ano}}</td>
                        <td style="text-align: center">{{deuda.periodo}}</td>
                        <td style="text-align: center">{{deuda.doc_num}}</td>
                        <td style="text-align: center">{{deuda.total_a_pagar}}</td>
                    </tr>
                    {% endfor %}
                </table>
            </td>
            {%else%}
            <td style="text-align: center; column-width: 140px;vertical-align: top;font-weight: bold;">Sin deudas
                registradas.</td>
            {%endif%}
            {%endfor%}
            </td>

        </tr>

        {%else%}
        <tr>
            <td style="text-align: center; column-width: 140px">Sin deudas tributarias SAT registradas.</td>
        </tr>
        {%endif%}
    </table>
    {% endif %}

    <!-- Record MTC -->
    {% if selection == "recmtc" %}
        <div class="col-md ">
            <img class= "border border-primary rounded", src = "{{ url_for('static', filename = '/images/')}}{{record}}" >
        </div>
    {% endif %}

    <!-- Multas SAT Lima-->
    {% if selection == "mulsat" %}
        <table style="color: white; background:#618685; max-width:100%; white-space:nowrap">
        <tr>
            <td colspan="4" style="color: white; font-weight: bold; background-color: #003b6d; text-align: center">
                Multas SAT Lima
            </td>
        </tr>
        {%if satmuls%}
        <tr>
            <td style="text-align: right; column-width:140px">Placa</td>
            {% for satmul in satmuls %}
            <td style="text-align: center; column-width:260px">
                {{satmul.placa}}
            </td>
            {% endfor %}
        </tr>
        <tr>
            <td style="text-align: right; column-width:140px">Licencia</td>
            {% for satmul in satmuls %}
            <td style="text-align: center; column-width:260px">
                {{satmul.licencia}}
            </td>
            {% endfor %}
        </tr>
        <tr>
            <td style="text-align: right;column-width:140px">Falta</td>
            {% for satmul in satmuls %}
            <td style="text-align: center">
                {{satmul.falta}}
            </td>
            {% endfor %}
        </tr>
        <tr>
            <td style="text-align: right">Documento</td>
            {% for satmul in satmuls %}
            <td style="text-align: center">
                {{satmul.documento}}
            </td>
            {% endfor %}
        </tr>
        <tr>
            <td style="text-align: right">Expedición</td>
            {% for satmul in satmuls %}
            <td style="text-align: center">
                {{satmul.fecha_emision}}
            </td>
            {% endfor %}
        </tr>
        <tr>
            <td style="text-align: right">Deuda</td>
            {% for satmul in satmuls %}
            <td style="text-align: center">
                S/ {{satmul.deuda}}
            </td>
            {% endfor %}
        </tr>
        {%else%}
        <tr>
            <td style="text-align: center; column-width: 140px">Sin multas registradas.</td>
        </tr>
        {% endif %}
    </table>
    {% endif %}

    <!-- Multas SUTRAN -->
    {% if selection == "mulsut" %}
        <table style="color: white; background:#618685; max-width:100%; white-space:nowrap">
            <tr>
                <td colspan="4" style="color: white; font-weight: bold; background-color: #003b6d; text-align: center">
                    Multas SUTRAN
                </td>
            </tr>
            {%if sutrans%}
            <tr>
                <td style="text-align: right; column-width:140px">Placa</td>
                {% for sutran in sutrans %}
                <td style="text-align: center; column-width:260px">
                    {{sutran.placa}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right;column-width:140px">Documento</td>
                {% for sutran in sutrans %}
                <td style="text-align: center">
                    {{sutran.documento}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right">Tipo</td>
                {% for sutran in sutrans %}
                <td style="text-align: center">
                    {{sutran.tipo}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right">Expedición</td>
                {% for sutran in sutrans %}
                <td style="text-align: center">
                    {{sutran.fecha_documento}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right">Infracción</td>
                {% for sutran in sutrans %}
                <td style="text-align: center">
                    {{sutran.infraccion}}
                </td>
                {% endfor %}
            </tr>
            {% else %}
            <tr>
                <td style="text-align: center; column-width: 140px">Sin multas registradas.</td>
            </tr>
            {% endif %}
        </table>
    {% endif %}

    <!-- Papeletas MTC  -->
    {% if selection == "papmtc" %}
        <table style="color: white; background:#618685; max-width:100%; white-space:nowrap">
            <tr>
                <td colspan="4" style="color: white; font-weight: bold; background-color: #003b6d; text-align: center">
            Papeletas Registradas en el MTC
                </td>
            </tr>
            {%if papeletas%}
            <tr>
                <td style="text-align: right; column-width:140px">Entidad</td>
                {% for papeleta in papeletas %}
                <td style="text-align: center; column-width:260px">
                    {{papeleta.entidad}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right;column-width:140px">Número</td>
                {% for papeleta in papeletas %}
                <td style="text-align: center">
                    {{papeleta.numero}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right">Fecha</td>
                {% for papeleta in papeletas %}
                <td style="text-align: center">
                    {{papeleta.fecha}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right">Fecha Firme</td>
                {% for papeleta in papeletas %}
                <td style="text-align: center">
                    {{papeleta.fecha_firme}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right">Falta</td>
                {% for papeleta in papeletas %}
                <td style="text-align: center">
                    {{papeleta.falta}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right">Estado de Deuda</td>
                {% for papeleta in papeletas %}
                <td style="text-align: center">
                    {{papeleta.estado_deuda}}
                </td>
                {% endfor %}
            </tr>
            {%else%}
            <tr>
                <td colspan="4" style="text-align: center">Sin papeletas registradas.</td>
            </tr>
            {%endif%}
        </table>
    {%endif%}
    

    <!-- Certificados SOAT  -->
    {% if selection == "soats" %}
        <table style="color: white; background:#618685; max-width:100%; white-space:nowrap">
            <tr>
                <td colspan="4" style="color: white; font-weight: bold; background-color: #003b6d; text-align: center">
                    Certificado SOAT
                </td>
            </tr>
            {%if soats%}
            <tr>
                <td style="text-align: right; column-width:140px">Placa</td>
                {% for soat in soats %}
                <td style="text-align: center; column-width:260px">
                    {{soat.placa}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right">Aseguradora</td>
                {% for soat in soats %}
                <td style="text-align: center">
                    {{soat.aseguradora}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right">Inicio</td>
                {% for soat in soats %}
                <td style="text-align: center">
                    {{soat.fecha_desde}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right;font-weight: bold;">Vigencia</td>
                {% for soat in soats %}
                <td style="text-align: center;font-weight: bold;">
                    {{soat.fecha_hasta}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right">Uso</td>
                {% for soat in soats %}
                <td style="text-align: center; word-wrap: break-word;">
                    {{soat.uso}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right; ">Clase</td>
                {% for soat in soats %}
                <td style="text-align: center">
                    {{soat.clase}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right; ">Tipo</td>
                {% for soat in soats %}
                <td style="text-align: center">
                    {{soat.tipo}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right; ">Certificado</td>
                {% for soat in soats %}
                <td style="text-align: center">
                    {{soat.certificado}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right; ">Status</td>
                {% for soat in soats %}
                <td style="text-align: center">
                    {{soat.vigencia}}
                </td>
                {% endfor %}
            </tr>
            {%else%}
            <tr>
                <td style="text-align: center; column-width: 140px">Sin registro de Certificado SOAT</td>
            </tr>
            {%endif%}

        </table>
    {% endif %}

    <!-- Revision Tecnica -->
    {% if selection == "revtec" %}
        <table style="color: white; background:#618685; max-width:100%; white-space:nowrap">
            <tr>
                <td colspan="4" style="color: white; font-weight: bold; background-color: #003b6d; text-align: center">
                    Revisión Técnica
                </td>
            </tr>
            {%if revtecs%}
            <tr>
                <td style="text-align: right; column-width:140px">Placa</td>
                {% for revtec in revtecs %}
                <td style="text-align: center; column-width:260px">
                    {{revtec.placa}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right">Expedición</td>
                {% for revtec in revtecs %}
                <td style="text-align: center">
                    {{revtec.fecha_desde}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right;font-weight: bold;">Vigencia</td>
                {% for revtec in revtecs %}
                <td style="text-align: center;font-weight: bold;">
                    {{revtec.fecha_hasta}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right">Resultado</td>
                {% for revtec in revtecs %}
                <td style="text-align: center">
                    {{revtec.resultado}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right">Certificadora</td>
                {% for revtec in revtecs %}
                <td style="text-align: center; word-wrap: break-word;">
                    {{revtec.certificadora}}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td style="text-align: right; ">Certificado</td>
                {% for revtec in revtecs %}
                <td style="text-align: center">
                    {{revtec.certificado}}
                </td>
                {% endfor %}
            </tr>
            {%else%}
            <tr>
                <td style="text-align: center; column-width: 140px">Sin registro de Revisiones Tecnicas</td>
            </tr>
            {%endif%}
        </table>
    {% endif %}

    <!-- Ficha SUNARP -->
    {% if selection == "sunarps" %}
        {% for sunarp in sunarps %}
            <div class="col-md ">
                <img class= "border border-primary rounded", src = "{{ url_for('static', filename = '/images/')}}{{sunarp}}" >
            </div>
        {% endfor %}
    {% endif %}

    <!-- Placeholder -->
    {% if selection == "X" %}
        <div class="col-md ">
            <img class= "border border-primary rounded", src = "{{ url_for('static', filename = '/images/')}}{{record}}" >
        </div>
    {% endif %}

    <!-- Placeholder -->
    {% if selection == "X" %}
        <div class="col-md ">
            <img class= "border border-primary rounded", src = "{{ url_for('static', filename = '/images/')}}{{record}}" >
        </div>
    {% endif %}

{% endblock content%}

<script>
    function sendToServer(category, option) {
      fetch('/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          category: category,
          option: option
        })
      })
      .then(response => {
        if (!response.ok) throw new Error('Network response was not ok');
        return response.json();
      })
      .then(data => {
        console.log('Server responded:', data);
        alert(`Success: ${data.message || 'Action processed'}`);
      })
      .catch(error => {
        console.error('Error sending to server:', error);
        alert('There was an error processing your request.');
      });
    }
  </script>